CREATE SCHEMA dw
Go
CREATE SCHEMA tempstage
Go
CREATE TABLE dw.Brand
(
BrandID INT NOT NULL IDENTITY PRIMARY KEY,
BrandName VARCHAR(255) NOT NULL,
);
Go
CREATE TABLE dw.Site
(
SiteID INT NOT NULL IDENTITY PRIMARY KEY,
TradingName VARCHAR(255),
Location VARCHAR(255),
Address VARCHAR(255),
Phone VARCHAR(255),
Latitude FLOAT,
Longitude FLOAT,
FullAddress VARCHAR(510),
);
Go
CREATE TABLE dw.SiteFeatures
(
SiteFeatureID INT NOT NULL IDENTITY PRIMARY KEY, 
SiteFeatures VARCHAR(2000),
SiteID INT,
FOREIGN KEY (SiteID) REFERENCES dw.Site(SiteID)
);
Go
CREATE TABLE dw.FuelPrice
(
FuelPriceID INT NOT NULL IDENTITY, 
BrandID INT NOT NULL,
SiteID INT NOT NULL,
DateID INT NOT NULL,
Price FLOAT,
DateCreated DATETIME NOT NULL DEFAULT GETDATE(), 
DateModified DATETIME
);
Go
CREATE CLUSTERED INDEX IDX_FuelPrice_DateID ON dw.FuelPrice(DateID)
Go
ALTER TABLE dw.FuelPrice ADD PRIMARY KEY (SiteID, BrandID, DateID)
Go
CREATE TRIGGER fuelpricerow_DateModified
ON dw.FuelPrice
AFTER UPDATE
AS
UPDATE dw.FuelPrice
SET DateModified = CURRENT_TIMESTAMP
WHERE FuelPriceID IN (SELECT DISTINCT FuelPriceID FROM INSERTED);